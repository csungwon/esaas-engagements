.page-header
  %h1
    = @user.name
    - git_url = 'https://www.github.com/'
    - unless @user.github_uid.blank?
      - git_url += @user.github_uid
    = link_to_unless@user.github_uid.blank?, image_tag('octocat.png'), git_url, :target => '_blank'

= link_to 'Edit User', edit_user_path(@user), class: 'btn btn-primary'
= link_to 'Back', users_path, class: 'btn btn-primary'
%br
%h3
  -unless @user.type_user.blank?
    %br
    %br
    ="Role: " + @user.type_user
    -if @user.type_user == 'student'
      %br
      %br
      ="SID: " + @user.SID
  -unless @user.github_uid.blank?
    %br
    %br
    ="Github ID: " + @user.github_uid
  -unless @user.preferred_contact.blank?
    %br
    %br
    ="Contact: " + @user.contact
  %br
  %br
  ="Engagements:"
  
%table.table
  %thead
    %tr
      %th App
      %th Role
      %th Started
      %th Contact
      %th Coach
      %th Team#
      %th Developers
      %th{:colspan => 3} Assets
      %th
  %tbody
    - Engagement.all.includes(:users).each_with_index do |engagement,indx|
      -role = nil
      -if engagement.users.include?(@user) 
        -role='Developer'
      -if engagement.coach == @user
        -role = 'Coach'
      -if engagement.contact == @user
        -role = 'Client'
      -unless role.blank?
        %tr
          %td= link_to engagement.app.name, app_path(engagement.app)
          %td= role
          %td= link_to engagement.start_date.strftime('%F'), engagement_iterations_path(engagement)
          %td= mail_to(engagement.contact.email, engagement.contact.name) if engagement.contact
          %td= [engagement.coach.try(:name),engagement.coaching_org.try(:name)].join(', ')
          %td= engagement.team_number
          %td
            %div{:class => 'members'}
              -engagement.users.each_with_index do |member, index|
                %div{:class => "member#{index}"} #{member.try(:name)}
          %td= link_to image_tag('deployment.png', size: '45x45', title: 'Deploy'), engagement.prototype_deployment_url, :target => '_blank'
          %td= link_to image_tag('video.png', title: 'Screencast'), engagement.screencast_url, :target => '_blank'
          %td= link_to image_tag('presentation.png', title: 'Presentation'), engagement.presentation_url, :target => '_blank'
          %td
            = link_to('Edit', edit_app_engagement_path(engagement.app,engagement), :class => 'btn btn-primary')
            = link_to 'Destroy', app_engagement_path(engagement.app,engagement), method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger'
            = link_to('CSV', export_path(engagement.app,engagement), :class => 'btn btn-info')