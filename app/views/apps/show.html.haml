.page-header
  %h1
    = link_to_unless @app.deployment_url.blank?, @app.name, @app.deployment_url, :target => '_blank'
    = link_to_unless @app.repository_url.blank?, image_tag('octocat.png'), @app.repository_url, :target => '_blank'
    - unless (url = @app.code_climate_url).blank?
      = link_to image_tag(url + '/badges/gpa.svg'), url, :target => '_blank'
      = link_to image_tag(url + '/badges/coverage.svg'), url, :target => '_blank'

.well#description
  %h4 Description
  %p= @app.description

.well#comments
  %h4 Comments
  #filters
  Show:
  - Comment.comment_types.keys.each do |type|
    = check_box_tag type, 1, true, :class => 'filter'
    %span{:class => type}= type.humanize
  :javascript
    $('.filter').change(function() { var klass = $(".comment-list ."+$(this).attr('name')).toggle(); });
  %div.comment-list
    -@app.comments.each do |comment|
      %div.media{class: comment.comment_type.to_s}
        %div.media-body
          %h5.media-heading
            = comment.user.name
            %div.pull-right
              = link_to 'Edit', edit_app_comment_path(@app, comment), :class => 'btn btn-primary btn-xs'
              = link_to 'Delete', app_comment_path(@app, comment), :method => :delete, :class => 'btn btn-danger btn-xs'
          %small.time= comment.created_at.strftime("%b %d, %Y at %l:%M:%S %p")
          %div.comment-body= comment.content

  = form_tag app_comments_path(@app) do
    = hidden_field :comment, :app_id, :value => @app.id
    = hidden_field :comment, :user_id, :value => @current_user.id
    %h4= "Write a comment"
    - Comment.comment_types.each do |name, value|
      = radio_button :comment, :comment_type, name, :checked => name == 'general'
      = label :comment, :comment_type, name.humanize
    = text_area :comment, :content
    %br= submit_tag 'Post', :class => "btn btn-primary"

= link_to 'Edit', edit_app_path(@app)
\|
= link_to 'Back', apps_path

.page-header
  %h1 Engagements
  = link_to 'New&hellip;'.html_safe, new_app_engagement_path(@app), :class => 'btn btn-primary'

%p.explanation
  Click on engagement start date to view or edit Iterations.

%table.table
  %thead
    %tr
      %th Started
      %th Contact
      %th Coach
      %th Team#
      %th Developers
      %th{:colspan => 3} Assets
      %th
  %tbody
    - @engagements.each_with_index do |engagement,indx|
      %tr
        %td= link_to engagement.start_date.strftime('%F'), engagement_iterations_path(engagement)
        %td= mail_to(engagement.contact.email, engagement.contact.name) if engagement.contact
        %td= [engagement.coach.try(:name),engagement.coaching_org.try(:name)].join(', ')
        %td= engagement.team_number
        %td
          %div{:class => 'members'}
            -engagement.users.each_with_index do |member, index|
              %div{:class => "member#{index}"} #{member.try(:name)}
        %td= link_to image_tag('octocat-gray.png'), engagement.prototype_deployment_url, :target => '_blank'
        %td= link_to image_tag('video.png'), engagement.screencast_url, :target => '_blank'
        %td= link_to image_tag('presentation.png'), engagement.presentation_url, :target => '_blank'
        %td= link_to('Edit', edit_app_engagement_path(@app,engagement), :class => 'btn btn-primary')
        %td= link_to 'Destroy', app_engagement_path(@app,engagement), method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger'
        %td= link_to('CSV', export_path(@app,engagement), :class => 'btn btn-primary')